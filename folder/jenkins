#!/bin/env groovy

node {
    deleteDir()

    checkout scm

    files = sh(returnStdout: true, script: 'ls')
    println "list of property files"
    p_files = files.split("\n").collect()[2,3]
    println (p_files)
    X_files = sh(returnStdout:true, script: 'cat prop-file')
    println (X_files)
    
    properties([buildDiscarder(logRotator(numToKeepStr: '100')),
        parameters([
                choice(choices: p_files, 
				description: 'test test', 
				name: 'param_files'),
                [$class: 'CascadeChoiceParameter',
				choiceType: 'PT_SINGLE_SELECT',
		                filterLength: 1, 
		                filterable: false,
				name: 'main_param',
		                choices: X_files,
				randomName: 'choice-parameter-348448661107465',
				referencedParameters: 'param_files',
		                script: [$class: 'GroovyScript', 
							script: [classpath: [], 
								 sandbox: false, 
								 script: sh(returnStdout: true, script: 'cat ${param_files}')
				     		        ]
				]
		]
      	])
	])
    
    sh 'echo Welcome to IT!'
}
